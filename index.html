<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Καταγραφή Παραλαβών</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://unpkg.com/docx@8.1.1/build/index.umd.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .nav button { margin-right: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>

  <div class="nav">
    <button onclick="goToPage('form-page')">Επιστροφή</button>
    <button onclick="exportToExcel()">Εξαγωγή σε Excel</button>
    <button onclick="exportToWord()">Εξαγωγή σε Word</button>
    <button onclick="window.print()">Εκτύπωση</button>
  </div>

  <div id="form-page" class="page active">
    <form id="ingredient-form">
      <label>Προϊόν: <input type="text" id="item" required></label><br><br>
      <label>Προέλευση: <input type="text" id="origin" required></label><br><br>
      <label>Ημερομηνία: <input type="date" id="date" required></label><br><br>
      <label>Σημειώσεις: <input type="text" id="notes"></label><br><br>
      <button type="submit">Προσθήκη</button>
    </form>
  </div>

  <table id="data-table">
    <thead>
      <tr>
        <th>Προϊόν</th>
        <th>Προέλευση</th>
        <th>Ημερομηνία</th>
        <th>Σημειώσεις</th>
        <th>Ενέργεια</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const form = document.getElementById('ingredient-form');
    const tableBody = document.querySelector('#data-table tbody');

    function goToPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
    }

    form.addEventListener('submit', function (event) {
      event.preventDefault();
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const item = document.getElementById('item').value.trim();
      const origin = document.getElementById('origin').value.trim();
      const date = document.getElementById('date').value;
      const notes = document.getElementById('notes').value.trim();

      const isDuplicate = Array.from(tableBody.rows).some(row =>
        row.cells[0].innerText === item && row.cells[1].innerText === origin
      );
      if (isDuplicate) {
        alert('Η καταχώρηση υπάρχει ήδη.');
        return;
      }

      const entry = { item, origin, date, notes };
      addRowToTable(entry);
      saveToLocalStorage();
      form.reset();
    });

    function addRowToTable(entry) {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${entry.item}</td>
        <td>${entry.origin}</td>
        <td>${entry.date}</td>
        <td>${entry.notes}</td>
        <td><button onclick="deleteRow(this)">Διαγραφή</button></td>`;
      tableBody.appendChild(row);
    }

    function deleteRow(button) {
      button.closest('tr').remove();
      saveToLocalStorage();
    }

    function saveToLocalStorage() {
      const rows = Array.from(tableBody.querySelectorAll('tr')).map(row => {
        const cells = row.querySelectorAll('td');
        return {
          item: cells[0].innerText,
          origin: cells[1].innerText,
          date: cells[2].innerText,
          notes: cells[3].innerText
        };
      });
      localStorage.setItem('ingredientData', JSON.stringify(rows));
    }

    function loadFromLocalStorage() {
      const data = JSON.parse(localStorage.getItem('ingredientData')) || [];
      data.forEach(entry => addRowToTable(entry));
    }

    function exportToExcel() {
      const workbook = XLSX.utils.table_to_book(document.getElementById('data-table'));
      XLSX.writeFile(workbook, 'ingredients.xlsx');
    }

    function exportToWord() {
      const { Document, Packer, Paragraph, Table, TableRow, TableCell, WidthType } = window.docx;
      const rows = Array.from(document.querySelectorAll('#data-table tr')).map(tr => {
        const cells = Array.from(tr.cells).slice(0, 4).map(td =>
          new TableCell({
            children: [new Paragraph(td.innerText)],
            width: { size: 25, type: WidthType.PERCENTAGE }
          })
        );
        return new TableRow({ children: cells });
      });

      const doc = new Document({
        sections: [{
          children: [
            new Paragraph({ text: "Καταγραφή Παραλαβών", heading: "Heading1" }),
            new Table({ rows })
          ]
        }]
      });

      Packer.toBlob(doc).then(blob => {
 
       saveAs(blob, "ingredients.docx");
      });
    }

    window.addEventListener('load', loadFromLocalStorage);
  </script>

</body>
</html>
