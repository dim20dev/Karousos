<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Karousos</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#007bff">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #e6f2ff;
      color: #003366;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #007bff;
      color: white;
      padding: 15px 20px;
      text-align: center;
    }
    .container {
      padding: 20px;
    }
    .page { display: none; }
    .active { display: block; }
    label {
      display: block;
      margin: 10px 0 5px;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #007bff;
      border-radius: 5px;
      margin-bottom: 15px;
      box-sizing: border-box;
    }
    button {
      background-color: #007bff;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
    }
    button:hover { background-color: #0056b3; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      overflow-x: auto;
      display: block;
      font-size: 14px;
    }
    th, td {
      border: 1px solid #007bff;
      padding: 10px;
      text-align: left;
      min-width: 100px;
    }
    th { background-color: #cce5ff; }
    .nav { margin-top: 20px; }
    @media (min-width: 600px) {
      button {
        width: auto;
        display: inline-block;
        margin-right: 10px;
      }
    }
  </style>
</head>
<body>
<header><h1>KAROUSOS</h1></header>
<div class="container">
  <div id="form-page" class="page active">
    <h2>Καινούρια παραλαβή</h2>
    <form id="ingredient-form" novalidate>
      <label for="item">Προϊόν</label>
      <input type="text" id="item" required>
      <label for="origin">Κωδικός</label>
      <input type="text" id="origin" required>
      <label for="date">Ημερομηνία παραλαβής</label>
      <input type="date" id="date" required>
      <label for="notes">Άλλες Πληροφορίες</label>
      <textarea id="notes" rows="3"></textarea>
      <button type="submit">Πρόσθεση παραλαβής</button>
    </form>
    <div class="nav"><button onclick="goToPage('table-page')">Παραλαβές</button></div>
  </div>
  <div id="table-page" class="page">
    <h2>Παραλαβές</h2>
    <div style="overflow-x: auto;">
      <table id="data-table">
        <thead><tr>
          <th>Προϊόν</th><th>Κωδικός</th><th>Ημερομηνία παραλαβής</th><th>Άλλες πληροφορίες</th><th>Ενέργεια</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="nav">
      <button onclick="goToPage('form-page')">Επιστροφή</button>
      <button onclick="exportToExcel()">Εξαγωγή σε Excel</button>
      <button onclick="exportToWord()">Εξαγωγή σε Word</button>
      <button onclick="window.print()">Εκτύπωση</button>
    </div>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://unpkg.com/docx@8.1.1/build/index.umd.js"></script>
<script>
  const form = document.getElementById('ingredient-form');
  const tableBody = document.querySelector('#data-table tbody');
  function goToPage(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
  }
  form.addEventListener('submit', function (event) {
    event.preventDefault();
    if (!form.checkValidity()) {
      form.reportValidity();
      return;
    }
    const item = document.getElementById('item').value.trim();
    const origin = document.getElementById('origin').value.trim();
    const date = document.getElementById('date').value;
    const notes = document.getElementById('notes').value.trim();
    const isDuplicate = Array.from(tableBody.rows).some(row =>
      row.cells[0].innerText === item && row.cells[1].innerText === origin
    );
    if (isDuplicate) {
      alert('Η καταχώρηση υπάρχει ήδη.');
      return;
    }
    const entry = { item, origin, date, notes };
    addRowToTable(entry);
    saveToLocalStorage();
    form.reset();
  });
  function addRowToTable(entry) {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${entry.item}</td>
      <td>${entry.origin}</td>
      <td>${entry.date}</td>
      <td>${entry.notes}</td>
      <td><button onclick="deleteRow(this)">Διαγραφή</button></td>`;
    tableBody.appendChild(row);
  }
  function deleteRow(button) {
    button.closest('tr').remove();
    saveToLocalStorage();
  }
  function saveToLocalStorage() {
    const rows = Array.from(tableBody.querySelectorAll('tr')).map(row => {
      const cells = row.querySelectorAll('td');
      return {
        item: cells[0].innerText,
        origin: cells[1].innerText,
        date: cells[2].innerText,
        notes: cells[3].innerText
      };
    });
    localStorage.setItem('ingredientData', JSON.stringify(rows));
  }
  function loadFromLocalStorage() {
    const data = JSON.parse(localStorage.getItem('ingredientData')) || [];
    data.forEach(entry => addRowToTable(entry));
  }
  window.addEventListener('load', loadFromLocalStorage);
  function exportToExcel() {
    const workbook = XLSX.utils.table_to_book(document.getElementById('data-table'));
    XLSX.writeFile(workbook, 'ingredients.xlsx');
  }
  function exportToWord() {
    const { Document, Packer, Paragraph, Table, TableRow, TableCell, WidthType } = window.docx;
    const rows = Array.from(document.querySelectorAll('#data-table tr')).map(tr => {
      const cells = Array.from(tr.cells).slice(0, 4).map(td =>
        new TableCell({ children: [new Paragraph(td.innerText)], width: { size: 25, type: WidthType.PERCENTAGE } })
      );
      return new TableRow({ children: cells });
    });
    const doc = new Document({
      sections: [{
        children: [
          new Paragraph({ text: "Καταγραφή Παραλαβών", heading: "Heading1" }),
          new Table({ rows })
        ]
      }]
    });
    Packer.toBlob(doc).then(blob => {
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'ingredients.docx';
      link.click();
    });
  }
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js').then(() => console.log('Service Worker Registered'));
  }
</script>
</body>
</html>
